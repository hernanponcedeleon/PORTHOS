Thread 0
a <- 1;
flag2 := a;
sync;
turn := a;
sync;
f1 <- flag1;
lwsync;
t1 <- turn;
lwsync;
While (f2 == 1 and t2 == 1)
  f1 <- flag1;
  lwsync;
  t1 <- turn;
b <- 0;
flag2 := b

Thread 1
c <- 1;
flag1 := c;
sync;
turn := c;
sync;
f2 <- flag2;
lwsync;
t2 <- turn;
lwsync;
While (f1 == 1 and t1 == 1)
  f2 <- flag2;
  lwsync;
  t2 <- turn;
d <- 0;
flag1 := d
